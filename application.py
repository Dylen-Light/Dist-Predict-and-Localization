import json
import threading

import joblib
import numpy as np
from keras.models import load_model
from sklearn.preprocessing import MinMaxScaler
import serial
from scipy.optimize import least_squares
from flask import Flask
from flask_cors import CORS
import csv


class MyEncoder(json.JSONEncoder):
    def default(self, obj):
        if isinstance(obj, np.integer):
            return int(obj)
        elif isinstance(obj, np.floating):
            return float(obj)
        elif isinstance(obj, np.ndarray):
            return obj.tolist()
        elif isinstance(obj, APInformation):
            d = {'__class__': obj.__class__.__name__, '__module__': obj.__module__}
            d.update(obj.__dict__)
            return d
        else:
            return super(MyEncoder, self).default(obj)


class APInformation:
    def __init__(self, apid, pos_x, pos_y, dist, is_valid, is_los):
        self.apid = apid
        self.pos_x = pos_x
        self.pos_y = pos_y
        self.dist = dist
        self.is_valid = is_valid
        self.is_los = is_los


def exec_predict(rssi, rtt, csi):
    # print("executing dest prediction with param:{ RSSI:", rssi, ", RTT:", rtt, ", CSI:", csi, "}.")
    raw_data = np.array([csi])
    raw_data = np.insert(raw_data, 0, rtt)
    raw_data = np.insert(raw_data, 0, rssi)
    # print(raw_data)

    feature_len = 2 + 128
    reshape_raw = raw_data.reshape(feature_len, 1)

    classify_data = classify_MinMaxScaler.transform(reshape_raw)
    classify_data = classify_data.reshape(1, 1, feature_len)
    los_nlos = classify_model.predict(classify_data)
    los_nlos = los_nlos.reshape(len(los_nlos), 1)
    los_nlos = classify_MinMaxScaler.inverse_transform(los_nlos)
    # print(los_nlos)
    # los_nlos = 1  # 调试用
    if not los_nlos[0][0] == 0:
        # 并非los环境
        pre_data = nlos_MinMaxScaler.transform(reshape_raw)
        pre_data = pre_data.reshape(1, 1, feature_len)
        dst_predict = nlos_pre_model.predict(pre_data)
        dst_predict = dst_predict.reshape(len(dst_predict), 1)
        dst_predict = nlos_MinMaxScaler.inverse_transform(dst_predict)
    else:
        # los环境
        pre_data = los_MinMaxScaler.transform(reshape_raw)
        pre_data = pre_data.reshape(1, 1, feature_len)
        dst_predict = los_pre_model.predict(pre_data)
        dst_predict = dst_predict.reshape(len(dst_predict), 1)
        dst_predict = los_MinMaxScaler.inverse_transform(dst_predict)

    # dst_predict = dst_predict.reshape(len(dst_predict), 1)
    print(dst_predict[0][0])
    print(los_nlos[0][0])
    return dst_predict[0][0], los_nlos[0][0]


class vec3d:

    def __init__(self, x, y, z):
        self.x = x
        self.y = y
        self.z = z


def calculate_distance(p1, p2):
    return np.sqrt((p1.x - p2.x) ** 2 + (p1.y - p2.y) ** 2 + (p1.z - p2.z) ** 2)


def error_function(params, anchor_positions, distances):
    num_anchors = len(anchor_positions)
    x, y, z = params

    # Compute distances from estimated position to anchors
    estimated_position = vec3d(x, y, z)
    estimated_distances = np.zeros(num_anchors)
    for i in range(num_anchors):
        estimated_distances[i] = calculate_distance(estimated_position,
                                                    anchor_positions[i])

    # Calculate error as the difference between estimated distances and measured distances
    error = estimated_distances - distances
    return error


def trilateration(anchor_positions, distances):
    # Initial estimate for the target position
    initial_position = np.array([0.0, 0.0, 0.0])

    # Use least squares optimization to minimize the error function
    result = least_squares(error_function,
                           initial_position,
                           args=(anchor_positions, distances))

    # Extract the estimated target position
    estimated_position = result.x
    return estimated_position


# 通过指定标签坐标，计算与各基站的距离
def get_distance(anchor_positions, tag_position):
    num_anchors = len(anchor_positions)
    distances = np.zeros(num_anchors)
    for i in range(num_anchors):
        distances[i] = calculate_distance(tag_position, anchor_positions[i])
    return distances


def info_collector():
    ser = serial.Serial('COM12', 115200)
    # 设置串口
    distance = 581
    # 设置实际距离，单位cm，收集数据用的
    isLoS = 1
    # 设置是否是LoS环境，1为是0为否，收集数据用的
    loop_time = 0
    with open('FTM_NLoS.csv', 'a', newline='') as file:
        # writer = csv.writer(file)
        # writer.writerow(["SN", "Name", "Contribution"])
        # ['0', '0', '9', '11', '9', '11', '8', '11', '9', '11', '8', '11', '8', '10', '9', '10', '9', '10', '9', '10', '9', '10', '9', '9', '9', '9', '10', '9', '10', '9', '10', '9', '10', '9', '10', '9', '10', '9', '10', '10', '10', '10', '9', '11', '9', '11', '8', '12', '8', '12', '7', '12', '5', '13', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '4', '9', '3', '10', '4', '10', '3', '10', '3', '10', '3', '10', '3', '11', '3', '11', '4', '11', '3', '11', '4', '11', '4', '10', '4', '11', '4', '11', '4', '10', '4', '11', '5', '10', '6', '10', '6', '10', '6', '10', '7', '10', '7', '10', '8', '11', '8', '10', '8', '11', '9', '11']
        # ['0', '0', '3', '13', '4', '12', '4', '13', '3', '11', '4', '12', '4', '12', '4', '11', '3', '11', '3', '11', '3', '10', '3', '11', '3', '10', '3', '11', '3', '11', '3', '10', '3', '11', '3', '10', '3', '11', '4', '11', '5', '10', '5', '10', '6', '10', '7', '10', '7', '9', '7', '8', '8', '8', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '8', '11', '9', '13', '7', '11', '9', '12', '8', '10', '9', '10', '8', '12', '7', '11', '10', '12', '11', '12', '7', '12', '9', '13', '8', '13', '9', '11', '6', '14', '6', '14', '6', '14', '4', '12', '3', '12', '5', '13', '3', '13', '4', '12', '3', '13', '3', '12', '3', '13', '3', '13']
        # ['0', '0', '8', '11', '6', '11', '7', '11', '6', '10', '6', '10', '6', '9', '6', '9', '6', '9', '6', '9', '6', '8', '6', '8', '6', '8', '6', '8', '7', '9', '6', '8', '6', '9', '6', '8', '5', '9', '5', '10', '5', '10', '4', '10', '3', '10', '3', '10', '2', '11', '1', '11', '0', '11', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '1', '15', '1', '14', '0', '14', '1', '15', '1', '15', '1', '16', '0', '13', '0', '14', '1', '16', '1', '12', '4', '14', '2', '12', '3', '12', '4', '14', '3', '11', '4', '12', '4', '12', '5', '12', '5', '12', '5', '12', '6', '11', '6', '11', '6', '10', '7', '11', '7', '10', '8', '10']
        # ['0', '0', '10', '12', '10', '11', '10', '11', '9', '11', '9', '10', '8', '10', '9', '10', '8', '9', '8', '9', '8', '9', '8', '9', '8', '8', '8', '8', '8', '8', '7', '8', '7', '8', '7', '8', '6', '8', '6', '8', '6', '8', '6', '8', '5', '8', '4', '8', '3', '9', '2', '8', '1', '8', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '9', '12', '8', '12', '7', '17', '9', '16', '5', '16', '9', '14', '5', '14', '6', '15', '4', '13', '6', '17', '7', '14', '6', '14', '8', '14', '7', '13', '7', '14', '9', '12', '8', '12', '8', '12', '8', '13', '9', '11', '10', '12', '10', '12', '10', '11', '10', '12', '10', '11', '10', '11']
        # ['0', '0', '2', '14', '4', '12', '3', '13', '3', '12', '3', '12', '3', '12', '3', '11', '2', '11', '3', '11', '2', '10', '2', '10', '2', '10', '2', '10', '2', '10', '2', '10', '2', '10', '3', '10', '3', '9', '3', '10', '4', '9', '5', '9', '5', '9', '6', '9', '6', '8', '7', '7', '8', '6', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '8', '13', '8', '12', '8', '13', '8', '12', '8', '13', '8', '13', '8', '13', '8', '13', '8', '12', '8', '12', '8', '12', '7', '12', '7', '12', '6', '12', '6', '12', '5', '12', '5', '12', '5', '12', '4', '12', '4', '13', '3', '13', '3', '13', '3', '13', '3', '13', '3', '13', '2', '13']
        # ['0', '0', '1', '15', '0', '14', '0', '14', '0', '14', '0', '13', '0', '13', '0', '12', '0', '13', '0', '12', '0', '12', '0', '12', '0', '12', '0', '12', '0', '12', '0', '12', '0', '12', '1', '12', '1', '12', '2', '12', '2', '12', '3', '12', '4', '11', '4', '11', '5', '10', '6', '10', '7', '9', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '4', '13', '5', '13', '4', '14', '4', '14', '5', '14', '7', '14', '5', '15', '5', '13', '1', '15', '1', '13', '3', '12', '3', '12', '5', '13', '4', '13', '4', '13', '3', '15', '1', '14', '2', '14', '1', '14', '1', '13', '0', '14', '0', '15', '0', '14', '0', '14', '0', '15', '1', '14']
        # ['80', '1', '27', '0', '8', '98', '0', '0', '51', '51', '0', '0', '0', '12', '8', '111', '80', '1', '41', '86', '8', '111', '80', '1', '41', '86', '96', '91', '105', '108', '0', '96', '114', '2', '0', '0', '60', '105', '32', '100', '125', '106', '28', '87', '27', '18', '105', '74', '111', '60', '101', '38', '128', '47', '104', '71', '7', '83', '91', '56', '69', '123', '95', '86', '83', '123', '4', '96', '127', '31', '123', '13', '61', '115', '0', '78', '5', '19', '97', '10', '80', '81', '25', '54', '10', '96', '121', '103', '69', '52', '13', '72', '4', '120', '106', '107', '122', '100', '46', '32', '44', '72', '70', '101', '3', '43', '39', '4', '98', '106', '63', '106', '126', '81', '53', '99', '27', '88', '4', '22', '2', '77', '86', '110', '30', '60', '87', '125']
        # ['0', '0', '6', '12', '6', '11', '6', '11', '5', '10', '5', '11', '6', '10', '5', '10', '5', '9', '5', '9', '4', '8', '5', '8', '5', '8', '5', '8', '5', '8', '5', '7', '5', '7', '6', '7', '6', '7', '6', '6', '7', '6', '7', '5', '7', '5', '8', '4', '8', '3', '8', '2', '9', '1', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '12', '10', '13', '11', '13', '11', '13', '11', '12', '11', '13', '11', '12', '11', '12', '11', '12', '11', '11', '11', '11', '11', '11', '10', '10', '11', '10', '11', '9', '11', '8', '11', '8', '12', '7', '11', '7', '12', '7', '12', '7', '12', '6', '12', '6', '12', '6', '13', '6', '12', '6', '12']
        # ['0', '0', '5', '12', '7', '10', '6', '11', '6', '10', '6', '10', '6', '10', '6', '10', '6', '10', '6', '10', '5', '10', '6', '10', '5', '10', '6', '10', '6', '11', '6', '11', '5', '12', '6', '12', '6', '12', '7', '12', '7', '12', '8', '12', '9', '12', '9', '12', '10', '12', '11', '11', '12', '11', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '12', '10', '12', '9', '12', '9', '12', '10', '11', '10', '12', '10', '11', '10', '11', '10', '10', '9', '10', '10', '10', '9', '9', '10', '9', '10', '8', '10', '8', '10', '7', '9', '7', '10', '6', '10', '7', '10', '6', '10', '6', '10', '6', '10', '5', '11', '6', '11', '5', '11', '5', '11']
        # ['0', '0', '11', '8', '11', '6', '11', '6', '10', '5', '10', '5', '9', '6', '9', '5', '9', '5', '8', '5', '8', '4', '7', '4', '8', '4', '8', '4', '8', '4', '7', '3', '7', '3', '7', '3', '7', '2', '7', '2', '7', '1', '7', '0', '6', '0', '6', '0', '6', '1', '5', '2', '5', '3', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '16', '4', '16', '4', '16', '4', '16', '4', '16', '4', '16', '4', '16', '4', '15', '4', '16', '4', '15', '4', '15', '4', '15', '4', '14', '4', '14', '5', '13', '5', '13', '5', '13', '5', '12', '6', '13', '6', '12', '7', '12', '7', '12', '7', '11', '7', '11', '7', '11', '7', '11', '7']
        # ['0', '0', '1', '13', '3', '13', '2', '12', '3', '12', '3', '12', '3', '11', '2', '11', '3', '10', '2', '10', '3', '10', '3', '10', '3', '10', '3', '9', '3', '9', '3', '9', '3', '9', '4', '8', '4', '8', '4', '8', '5', '8', '5', '7', '6', '7', '7', '6', '8', '5', '8', '4', '9', '4', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '9', '10', '19', '1', '22', '4', '17', '4', '13', '7', '6', '10', '18', '7', '18', '9', '17', '7', '15', '8', '16', '7', '14', '7', '14', '4', '14', '6', '14', '4', '16', '4', '12', '5', '14', '6', '13', '2', '13', '2', '14', '3', '15', '2', '14', '3', '14', '3', '14', '1', '13']
        # ['0', '0', '13', '2', '12', '1', '12', '1', '11', '1', '11', '1', '11', '1', '10', '1', '10', '1', '10', '1', '9', '1', '9', '1', '9', '1', '9', '1', '9', '1', '9', '0', '8', '0', '8', '0', '8', '1', '9', '1', '9', '2', '8', '3', '8', '3', '7', '3', '7', '4', '6', '5', '6', '6', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '18', '5', '17', '5', '15', '6', '15', '6', '14', '5', '14', '5', '15', '6', '14', '5', '15', '5', '16', '4', '14', '4', '15', '4', '14', '2', '14', '2', '14', '1', '14', '1', '13', '0', '14', '0', '13', '0', '13', '1', '13', '1', '12', '2', '13', '2', '13', '2', '13', '2', '12', '2']
        # ['0', '0', '5', '12', '5', '11', '5', '10', '4', '10', '4', '10', '4', '9', '4', '9', '4', '9', '4', '8', '4', '8', '4', '8', '4', '8', '4', '7', '4', '7', '4', '7', '4', '7', '5', '7', '6', '7', '5', '7', '6', '7', '6', '6', '7', '6', '7', '5', '7', '4', '7', '3', '8', '2', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '11', '11', '16', '11', '14', '9', '16', '9', '15', '12', '13', '10', '14', '11', '11', '9', '12', '11', '13', '10', '12', '10', '11', '10', '11', '10', '11', '12', '10', '10', '9', '11', '9', '12', '7', '12', '7', '11', '6', '12', '5', '11', '6', '12', '6', '11', '5', '12', '5', '12', '5', '11']
        # ['0', '0', '6', '9', '4', '10', '5', '10', '4', '9', '4', '9', '5', '9', '5', '9', '6', '9', '5', '9', '5', '9', '6', '9', '6', '10', '5', '11', '6', '12', '8', '10', '8', '11', '8', '11', '11', '14', '10', '15', '5', '14', '6', '17', '9', '20', '12', '16', '5', '14', '11', '12', '2', '15', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '4', '17', '3', '16', '3', '15', '3', '15', '3', '14', '6', '14', '5', '13', '3', '14', '6', '13', '4', '12', '4', '12', '5', '12', '5', '11', '5', '11', '5', '10', '5', '10', '5', '10', '5', '8', '5', '8', '5', '8', '5', '8', '6', '8', '5', '8', '6', '8', '5', '9', '6', '9']
        # ['0', '0', '11', '3', '12', '5', '11', '4', '11', '5', '11', '4', '10', '4', '10', '4', '9', '4', '10', '4', '10', '5', '9', '4', '10', '4', '10', '4', '10', '3', '11', '4', '10', '3', '12', '4', '11', '6', '12', '5', '11', '4', '12', '0', '12', '6', '11', '8', '18', '3', '10', '8', '11', '9', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '13', '11', '11', '14', '10', '13', '12', '12', '14', '12', '10', '14', '12', '11', '12', '14', '14', '14', '9', '10', '12', '10', '13', '10', '11', '10', '13', '7', '12', '7', '11', '8', '11', '5', '12', '6', '12', '6', '12', '5', '13', '5', '12', '5', '12', '5', '12', '4', '11', '5', '11', '5']
        # ['0', '0', '4', '3', '4', '4', '4', '4', '4', '5', '3', '6', '3', '6', '3', '7', '3', '7', '3', '8', '4', '9', '4', '9', '4', '10', '6', '10', '6', '11', '6', '12', '7', '13', '7', '13', '7', '13', '8', '15', '8', '16', '8', '17', '8', '18', '8', '17', '8', '19', '7', '20', '5', '21', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '23', '7', '18', '8', '21', '6', '17', '4', '18', '3', '19', '6', '21', '4', '20', '3', '18', '6', '16', '2', '16', '2', '14', '1', '14', '0', '13', '0', '13', '0', '11', '1', '11', '0', '10', '0', '9', '1', '9', '0', '8', '0', '7', '0', '7', '0', '6', '0', '6', '1', '5', '2']
        # ['0', '0', '13', '3', '12', '3', '13', '3', '12', '3', '12', '3', '11', '3', '12', '3', '12', '3', '12', '3', '11', '3', '12', '3', '12', '3', '13', '3', '13', '3', '12', '3', '13', '3', '12', '3', '14', '3', '14', '4', '14', '4', '14', '5', '14', '5', '13', '6', '14', '6', '14', '8', '13', '9', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '14', '10', '16', '8', '13', '8', '16', '8', '14', '10', '16', '4', '15', '4', '15', '13', '16', '5', '17', '8', '16', '12', '13', '5', '13', '4', '13', '1', '13', '2', '12', '2', '12', '5', '12', '4', '14', '4', '13', '4', '12', '3', '11', '3', '12', '2', '12', '1', '13', '2', '12', '2']
        # ['0', '0', '7', '6', '6', '6', '5', '6', '5', '6', '5', '6', '4', '6', '4', '6', '4', '6', '4', '6', '4', '6', '3', '6', '3', '6', '3', '7', '3', '7', '3', '7', '3', '8', '3', '8', '3', '8', '3', '9', '3', '9', '2', '10', '1', '10', '1', '10', '0', '11', '0', '11', '2', '11', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '9', '16', '10', '12', '13', '13', '7', '14', '11', '16', '13', '13', '13', '13', '7', '13', '10', '13', '10', '9', '12', '12', '10', '13', '10', '10', '11', '10', '12', '11', '10', '10', '9', '8', '7', '9', '11', '7', '10', '8', '8', '6', '9', '6', '8', '7', '7', '7', '7', '6', '8', '7']
        # ['0', '0', '13', '1', '13', '0', '13', '0', '13', '0', '13', '0', '13', '1', '13', '1', '13', '2', '13', '2', '13', '2', '13', '2', '13', '3', '13', '3', '13', '4', '14', '5', '14', '5', '15', '5', '15', '6', '15', '6', '16', '6', '16', '6', '16', '6', '17', '6', '17', '5', '17', '4', '18', '3', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '14', '1', '15', '5', '13', '3', '13', '5', '13', '2', '12', '3', '10', '4', '13', '4', '12', '6', '11', '6', '11', '3', '13', '3', '12', '2', '11', '1', '13', '1', '12', '1', '10', '0', '11', '2', '10', '1', '11', '1', '11', '1', '11', '0', '11', '0', '11', '1', '12', '0', '12', '0']
        # ['0', '0', '11', '6', '11', '5', '11', '4', '11', '5', '11', '4', '11', '5', '11', '5', '11', '5', '11', '4', '10', '5', '11', '5', '11', '6', '11', '6', '11', '6', '11', '7', '11', '6', '13', '7', '13', '7', '13', '7', '13', '8', '14', '7', '15', '8', '15', '8', '16', '7', '16', '6', '17', '4', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '17', '1', '16', '1', '19', '4', '15', '1', '15', '3', '15', '4', '13', '4', '16', '4', '15', '2', '13', '1', '15', '1', '14', '3', '14', '3', '14', '4', '12', '6', '10', '6', '11', '5', '12', '4', '9', '4', '10', '4', '10', '5', '10', '4', '10', '5', '10', '5', '10', '5', '10', '4']
        # ['0', '0', '7', '10', '8', '10', '5', '9', '7', '10', '8', '9', '8', '9', '7', '9', '7', '10', '7', '8', '8', '8', '8', '9', '7', '8', '7', '8', '8', '8', '9', '8', '10', '8', '9', '9', '9', '9', '8', '10', '9', '10', '8', '10', '9', '10', '8', '12', '7', '12', '7', '13', '7', '14', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '7', '11', '8', '8', '5', '9', '2', '10', '1', '6', '5', '9', '5', '8', '6', '7', '2', '8', '5', '11', '5', '11', '4', '10', '5', '9', '5', '9', '6', '9', '5', '8', '3', '12', '3', '9', '5', '9', '5', '8', '5', '7', '5', '8', '7', '9', '8', '9', '6', '9', '9', '10']
        # ['0', '0', '9', '9', '9', '9', '8', '8', '8', '9', '8', '8', '7', '8', '7', '7', '7', '7', '7', '7', '7', '7', '7', '6', '6', '6', '6', '6', '6', '6', '6', '6', '5', '6', '5', '6', '5', '6', '4', '6', '4', '7', '3', '7', '2', '7', '2', '7', '1', '6', '0', '7', '1', '6', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '10', '12', '12', '12', '11', '15', '11', '13', '10', '13', '10', '13', '10', '13', '10', '13', '9', '14', '9', '14', '9', '12', '9', '12', '9', '12', '10', '12', '9', '12', '9', '12', '10', '10', '8', '10', '9', '11', '9', '9', '10', '10', '9', '9', '10', '9', '10', '9', '10', '9', '10', '9']
        # ['0', '0', '6', '9', '7', '9', '7', '8', '7', '8', '7', '8', '6', '8', '6', '8', '6', '7', '6', '7', '6', '7', '6', '7', '6', '8', '6', '7', '6', '8', '6', '8', '6', '8', '6', '9', '6', '8', '7', '9', '7', '9', '8', '8', '9', '9', '10', '8', '10', '8', '10', '7', '12', '6', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '13', '8', '8', '13', '10', '11', '10', '15', '10', '15', '10', '9', '8', '12', '8', '6', '6', '10', '13', '10', '12', '11', '10', '9', '8', '8', '10', '8', '6', '7', '8', '9', '8', '7', '7', '7', '6', '8', '8', '10', '7', '9', '6', '9', '6', '10', '6', '10', '6', '9', '6', '9']
        # ['0', '0', '3', '11', '4', '10', '4', '10', '4', '10', '3', '9', '3', '9', '3', '9', '3', '9', '3', '9', '3', '9', '3', '9', '4', '9', '3', '9', '3', '9', '3', '9', '4', '9', '4', '10', '3', '10', '5', '9', '5', '10', '6', '10', '7', '11', '8', '10', '8', '9', '9', '9', '10', '8', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '12', '14', '11', '14', '11', '14', '12', '14', '11', '14', '11', '13', '10', '13', '11', '13', '11', '13', '10', '12', '9', '12', '9', '12', '9', '12', '8', '12', '7', '12', '7', '11', '6', '12', '6', '11', '5', '12', '4', '11', '4', '11', '4', '12', '4', '12', '4', '11', '3', '12', '3', '12']
        # ['0', '0', '11', '5', '11', '5', '10', '4', '10', '5', '10', '4', '9', '4', '9', '4', '8', '4', '9', '3', '8', '4', '8', '4', '7', '3', '7', '3', '7', '3', '7', '3', '7', '3', '7', '4', '6', '4', '6', '4', '6', '5', '6', '5', '5', '5', '4', '5', '3', '6', '3', '6', '2', '6', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '17', '12', '16', '12', '16', '12', '16', '12', '16', '12', '16', '12', '15', '13', '14', '12', '15', '12', '14', '12', '13', '12', '13', '11', '13', '11', '13', '10', '13', '9', '13', '9', '13', '8', '12', '8', '13', '7', '13', '7', '13', '7', '12', '6', '13', '6', '12', '6', '12', '6', '12', '6']
        # ['0', '0', '8', '9', '10', '9', '10', '9', '9', '9', '9', '8', '9', '7', '9', '7', '9', '6', '9', '6', '9', '6', '9', '5', '9', '5', '9', '5', '9', '5', '9', '5', '9', '5', '9', '5', '9', '6', '9', '6', '8', '6', '7', '6', '7', '7', '5', '7', '5', '6', '5', '7', '3', '7', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '10', '16', '3', '22', '5', '19', '0', '21', '3', '24', '4', '19', '8', '21', '7', '21', '3', '17', '8', '18', '7', '15', '6', '16', '7', '16', '7', '19', '6', '14', '7', '16', '5', '16', '7', '16', '7', '14', '8', '13', '9', '12', '8', '13', '8', '12', '9', '11', '9', '11', '9', '11']
        # ['0', '0', '2', '12', '1', '11', '1', '10', '2', '10', '2', '10', '2', '10', '2', '9', '2', '9', '2', '8', '2', '9', '2', '8', '2', '8', '2', '7', '2', '8', '2', '8', '2', '7', '1', '7', '1', '7', '1', '8', '0', '8', '0', '7', '1', '7', '2', '6', '3', '6', '3', '5', '4', '5', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '19', '0', '18', '1', '18', '2', '18', '2', '18', '1', '18', '3', '17', '3', '17', '3', '17', '3', '16', '3', '15', '3', '15', '3', '15', '3', '15', '2', '14', '1', '14', '1', '14', '1', '14', '1', '13', '0', '13', '0', '13', '0', '13', '1', '12', '1', '12', '1', '12', '2', '12']
        # ['0', '0', '12', '0', '12', '0', '11', '1', '11', '0', '11', '0', '10', '0', '11', '0', '10', '1', '10', '0', '11', '1', '9', '1', '8', '2', '8', '3', '5', '1', '10', '0', '7', '6', '6', '4', '3', '1', '6', '3', '12', '8', '9', '3', '8', '8', '4', '9', '12', '2', '2', '4', '8', '1', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '14', '0', '13', '1', '14', '1', '14', '1', '13', '0', '13', '0', '13', '0', '15', '1', '13', '1', '14', '1', '12', '1', '12', '2', '13', '1', '13', '0', '12', '0', '13', '0', '12', '0', '12', '0', '12', '1', '12', '1', '12', '0', '13', '1', '12', '0', '12', '1', '12', '1', '13', '0']
        # ['0', '0', '0', '11', '1', '11', '1', '11', '1', '10', '1', '11', '1', '9', '1', '9', '1', '9', '1', '9', '1', '9', '1', '7', '0', '5', '1', '8', '1', '9', '3', '8', '2', '9', '4', '2', '2', '14', '2', '3', '6', '8', '5', '4', '6', '8', '6', '1', '9', '7', '8', '2', '7', '5', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '9', '11', '2', '12', '5', '15', '9', '12', '7', '13', '1', '15', '8', '15', '4', '13', '4', '17', '1', '11', '4', '11', '3', '14', '1', '13', '0', '13', '2', '10', '1', '14', '3', '12', '2', '10', '1', '12', '3', '11', '3', '12', '1', '12', '2', '11', '2', '11', '2', '12', '1', '11']
        # ['0', '0', '2', '12', '2', '13', '2', '13', '2', '13', '2', '13', '2', '11', '2', '11', '2', '11', '1', '11', '1', '10', '1', '11', '1', '10', '1', '9', '1', '10', '1', '10', '1', '9', '2', '9', '2', '9', '2', '9', '3', '7', '3', '7', '4', '7', '5', '6', '5', '5', '5', '4', '5', '3', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '9', '16', '9', '15', '10', '16', '10', '15', '10', '15', '11', '15', '10', '15', '10', '14', '10', '14', '10', '14', '10', '13', '9', '13', '9', '13', '8', '13', '7', '13', '6', '13', '6', '13', '5', '13', '6', '14', '5', '14', '4', '14', '4', '14', '4', '14', '4', '14', '4', '14', '3', '14']
        # ['0', '0', '7', '11', '6', '12', '6', '12', '6', '11', '6', '11', '6', '11', '5', '11', '6', '11', '6', '11', '7', '11', '6', '11', '6', '10', '6', '11', '6', '11', '6', '11', '4', '11', '7', '11', '6', '13', '4', '10', '5', '11', '4', '10', '3', '15', '2', '16', '3', '13', '0', '17', '2', '14', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '2', '12', '3', '9', '3', '14', '4', '11', '5', '10', '4', '8', '2', '10', '3', '8', '1', '14', '2', '13', '0', '11', '3', '11', '2', '11', '5', '10', '2', '11', '2', '12', '3', '12', '4', '11', '5', '9', '5', '10', '5', '10', '5', '11', '5', '11', '6', '11', '6', '11', '6', '11']
        # ['0', '0', '14', '5', '12', '7', '12', '6', '10', '5', '11', '5', '11', '5', '10', '5', '10', '5', '10', '5', '9', '4', '8', '5', '8', '4', '8', '5', '8', '5', '8', '5', '7', '5', '7', '5', '7', '5', '6', '6', '6', '6', '6', '7', '5', '7', '4', '7', '3', '7', '2', '8', '1', '8', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '14', '14', '13', '10', '11', '13', '15', '16', '8', '13', '13', '14', '14', '12', '11', '14', '12', '14', '12', '12', '12', '12', '12', '12', '11', '11', '12', '11', '12', '11', '12', '9', '12', '9', '13', '8', '13', '8', '14', '8', '13', '7', '13', '7', '13', '6', '13', '6', '13', '6', '13', '6']
        # ['0', '0', '7', '6', '7', '5', '7', '5', '7', '4', '6', '4', '7', '3', '6', '3', '6', '3', '7', '2', '7', '2', '7', '2', '7', '1', '8', '1', '9', '1', '9', '1', '9', '1', '10', '0', '10', '0', '11', '0', '11', '1', '12', '1', '13', '1', '14', '2', '14', '3', '14', '5', '14', '6', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '21', '4', '20', '4', '20', '5', '20', '5', '19', '5', '19', '5', '18', '5', '18', '5', '17', '6', '16', '6', '16', '6', '15', '6', '14', '7', '13', '7', '12', '7', '11', '7', '10', '8', '10', '7', '10', '8', '9', '7', '9', '8', '8', '8', '8', '7', '7', '7', '7', '8', '7', '6']
        # ['0', '0', '3', '6', '3', '7', '2', '6', '1', '6', '0', '5', '0', '6', '1', '4', '1', '4', '2', '3', '1', '5', '2', '3', '4', '2', '4', '2', '5', '2', '5', '2', '6', '2', '6', '2', '7', '1', '8', '1', '9', '1', '10', '1', '10', '1', '10', '2', '12', '2', '11', '4', '12', '5', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '2', '18', '11', '13', '9', '19', '0', '17', '5', '25', '4', '22', '0', '12', '2', '17', '8', '14', '9', '17', '4', '11', '2', '14', '3', '14', '2', '14', '9', '13', '7', '15', '6', '14', '8', '10', '5', '11', '5', '12', '7', '11', '6', '9', '5', '10', '5', '9', '5', '8', '4', '7']
        # ['0', '0', '11', '3', '11', '3', '10', '3', '9', '3', '9', '2', '8', '2', '7', '3', '6', '3', '5', '3', '5', '3', '5', '3', '3', '3', '3', '3', '2', '3', '1', '3', '1', '3', '0', '4', '1', '4', '2', '4', '2', '4', '4', '5', '5', '4', '6', '4', '7', '3', '8', '3', '9', '2', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '19', '10', '20', '10', '19', '10', '19', '11', '18', '10', '19', '11', '18', '10', '18', '10', '18', '10', '17', '9', '16', '10', '16', '9', '16', '9', '16', '8', '16', '7', '15', '7', '15', '7', '14', '5', '15', '5', '15', '4', '14', '4', '14', '3', '13', '4', '13', '3', '13', '3', '14', '3']
        # ['0', '0', '3', '9', '3', '8', '3', '7', '2', '7', '2', '6', '2', '5', '2', '4', '2', '4', '2', '3', '2', '2', '2', '2', '2', '1', '3', '1', '3', '0', '3', '1', '4', '2', '4', '2', '4', '3', '5', '4', '5', '5', '5', '5', '7', '6', '3', '6', '8', '9', '2', '12', '2', '9', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '16', '14', '16', '14', '17', '16', '16', '12', '16', '13', '16', '16', '12', '12', '12', '15', '8', '14', '15', '14', '12', '15', '12', '13', '11', '14', '10', '13', '11', '12', '7', '14', '8', '11', '8', '12', '5', '11', '6', '11', '5', '11', '4', '11', '5', '11', '4', '11', '4', '11', '3', '10']
        # ['0', '0', '11', '2', '10', '2', '9', '1', '8', '1', '8', '0', '7', '0', '6', '1', '6', '1', '6', '2', '5', '2', '4', '2', '5', '3', '4', '4', '4', '4', '4', '5', '3', '5', '3', '6', '3', '8', '3', '8', '2', '9', '2', '10', '1', '10', '0', '11', '1', '12', '2', '13', '4', '13', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '24', '3', '24', '3', '23', '3', '23', '3', '23', '4', '23', '4', '22', '3', '22', '3', '21', '3', '21', '2', '20', '1', '19', '1', '19', '0', '18', '0', '18', '1', '17', '1', '17', '2', '15', '2', '15', '3', '15', '3', '15', '3', '14', '3', '13', '4', '13', '4', '12', '4', '12', '3']
        # ['0', '0', '6', '7', '5', '7', '5', '7', '5', '6', '5', '6', '4', '3', '3', '4', '4', '2', '4', '2', '4', '2', '4', '1', '4', '0', '3', '1', '3', '1', '4', '1', '3', '1', '4', '2', '4', '3', '4', '4', '4', '5', '3', '6', '3', '7', '2', '8', '2', '9', '1', '10', '0', '10', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '19', '12', '19', '11', '19', '11', '19', '11', '19', '11', '19', '11', '19', '10', '18', '11', '17', '10', '17', '10', '16', '10', '15', '10', '14', '10', '13', '10', '13', '10', '11', '10', '10', '10', '10', '11', '11', '12', '9', '10', '8', '11', '7', '9', '8', '9', '8', '10', '8', '10', '6', '8']
        # ['0', '0', '2', '8', '3', '6', '2', '6', '3', '5', '3', '5', '3', '4', '2', '4', '3', '4', '0', '3', '2', '3', '2', '3', '2', '3', '5', '0', '1', '2', '4', '1', '1', '2', '6', '3', '3', '1', '3', '11', '4', '2', '4', '3', '5', '0', '2', '2', '2', '0', '8', '3', '5', '13', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '16', '6', '15', '6', '15', '6', '15', '5', '14', '8', '13', '7', '14', '4', '13', '9', '10', '9', '9', '9', '11', '8', '12', '7', '10', '8', '8', '7', '7', '7', '9', '7', '9', '9', '6', '7', '6', '8', '5', '9', '5', '9', '4', '8', '4', '9', '3', '8', '3', '8', '2', '7']
        # ['0', '0', '8', '4', '7', '2', '7', '2', '7', '2', '6', '1', '6', '1', '5', '1', '5', '0', '5', '0', '5', '1', '5', '2', '4', '2', '4', '2', '5', '3', '5', '3', '4', '4', '5', '4', '5', '5', '5', '6', '5', '7', '5', '8', '4', '9', '4', '9', '3', '10', '3', '11', '2', '12', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '22', '2', '22', '1', '22', '1', '22', '1', '22', '1', '21', '2', '20', '1', '20', '2', '20', '2', '18', '2', '18', '2', '17', '3', '17', '2', '16', '3', '15', '3', '14', '4', '14', '4', '13', '4', '13', '5', '12', '5', '12', '5', '11', '5', '10', '4', '10', '4', '9', '4', '9', '4']
        # ['0', '0', '7', '7', '7', '4', '7', '3', '5', '3', '6', '2', '5', '2', '5', '1', '5', '1', '5', '0', '5', '0', '5', '1', '5', '2', '6', '3', '6', '3', '6', '3', '6', '5', '7', '5', '7', '5', '7', '7', '7', '8', '8', '9', '8', '9', '7', '10', '7', '11', '6', '13', '5', '14', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '20', '12', '20', '12', '20', '15', '19', '15', '22', '12', '20', '15', '18', '11', '18', '12', '14', '14', '14', '10', '17', '11', '16', '13', '14', '10', '14', '10', '14', '11', '10', '11', '12', '8', '9', '10', '9', '9', '10', '10', '9', '9', '8', '8', '8', '8', '8', '8', '7', '8', '7', '6']
        # ['0', '0', '2', '9', '0', '9', '0', '9', '0', '8', '1', '8', '0', '9', '1', '9', '1', '8', '0', '9', '0', '8', '0', '9', '0', '9', '0', '10', '1', '10', '0', '10', '1', '11', '1', '11', '1', '12', '1', '13', '1', '13', '1', '14', '0', '15', '0', '14', '0', '15', '1', '15', '2', '17', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '16', '21', '17', '11', '5', '9', '18', '17', '1', '18', '11', '17', '14', '9', '4', '17', '2', '15', '3', '15', '4', '13', '4', '13', '4', '13', '3', '11', '1', '9', '1', '12', '4', '12', '4', '9', '2', '10', '2', '10', '2', '11', '1', '10', '1', '10', '1', '9', '1', '9', '1', '10']
        # ['0', '0', '6', '5', '5', '4', '4', '4', '3', '4', '3', '4', '2', '4', '2', '4', '2', '4', '1', '4', '1', '4', '1', '5', '0', '5', '0', '5', '0', '6', '0', '7', '0', '7', '1', '8', '0', '8', '1', '9', '1', '9', '2', '10', '3', '10', '3', '11', '4', '11', '5', '12', '6', '11', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '13', '17', '13', '16', '12', '16', '12', '16', '12', '15', '12', '15', '12', '14', '12', '14', '12', '13', '11', '12', '11', '12', '11', '11', '11', '10', '11', '10', '10', '9', '10', '9', '10', '7', '10', '7', '9', '6', '10', '5', '9', '5', '9', '4', '8', '4', '8', '4', '8', '5', '8', '4']
        # ['0', '0', '7', '4', '7', '3', '6', '2', '6', '2', '6', '1', '5', '1', '5', '1', '5', '0', '5', '0', '5', '1', '5', '1', '5', '1', '6', '1', '6', '1', '6', '2', '7', '2', '7', '2', '8', '3', '8', '3', '9', '4', '9', '4', '9', '5', '9', '6', '10', '7', '10', '8', '10', '9', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '20', '5', '24', '7', '18', '1', '21', '1', '19', '7', '15', '0', '20', '2', '17', '2', '20', '10', '16', '8', '16', '2', '18', '0', '16', '2', '15', '0', '12', '1', '12', '5', '13', '4', '11', '2', '11', '4', '11', '4', '10', '4', '10', '4', '9', '5', '9', '4', '8', '4', '8', '3']
        # ['51', '48', '12', '0', '128', '0', '0', '0', '1', '1', '1', '1', '1', '1', '112', '4', '29', '76', '48', '77', '112', '4', '29', '76', '48', '77', '48', '98', '108', '111', '70', '8', '0', '0', '0', '0', '100', '0', '49', '4', '0', '16', '102', '116', '109', '95', '55', '48', '48', '52', '49', '68', '52', '67', '68', '48', '52', '67', '1', '8', '117', '106', '126', '124', '12', '24', '48', '96', '3', '1', '11', '5', '6', '1', '2', '0', '0', '0', '0', '42', '1', '0', '50', '4', '108', '18', '36', '72', '48', '26', '1', '0', '0', '15', '84', '4', '1', '0', '0', '15', '84', '4', '1', '0', '0', '15', '84', '2', '128', '0', '0', '0', '0', '15', '84', '6', '45', '26', '110', '17', '0', '1', '0', '0', '0', '0', '0', '0']
        # ['0', '0', '7', '7', '7', '7', '6', '6', '6', '6', '6', '5', '6', '4', '6', '3', '6', '3', '6', '2', '6', '2', '6', '2', '6', '1', '7', '0', '7', '0', '7', '0', '8', '1', '8', '1', '8', '3', '8', '4', '9', '5', '9', '6', '9', '7', '10', '8', '9', '9', '9', '11', '8', '12', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '17', '11', '18', '16', '15', '15', '19', '11', '18', '14', '19', '12', '18', '15', '20', '14', '17', '9', '17', '13', '13', '17', '12', '11', '14', '10', '14', '9', '11', '12', '9', '11', '10', '11', '9', '10', '9', '11', '8', '10', '8', '11', '8', '10', '7', '10', '7', '10', '7', '9', '8', '9']
        # ['0', '0', '8', '3', '9', '4', '5', '3', '4', '4', '5', '6', '3', '5', '5', '5', '2', '7', '1', '5', '4', '5', '1', '5', '3', '6', '2', '6', '1', '5', '1', '7', '1', '8', '1', '8', '0', '8', '1', '10', '1', '11', '2', '11', '2', '12', '3', '13', '4', '14', '5', '13', '6', '14', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '13', '17', '12', '16', '13', '16', '12', '14', '12', '16', '14', '14', '13', '15', '12', '13', '12', '12', '12', '12', '12', '11', '13', '9', '10', '10', '11', '9', '13', '7', '13', '6', '9', '6', '12', '6', '10', '3', '11', '4', '9', '3', '10', '1', '11', '4', '9', '4', '11', '2', '7', '3']
        # ['0', '0', '0', '4', '1', '6', '1', '5', '3', '6', '2', '6', '2', '4', '2', '6', '3', '3', '3', '4', '4', '4', '4', '3', '4', '5', '5', '4', '3', '4', '9', '2', '4', '3', '1', '1', '7', '2', '7', '2', '13', '5', '0', '4', '10', '5', '5', '5', '2', '7', '11', '9', '9', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '3', '12', '5', '9', '6', '10', '0', '16', '8', '9', '3', '14', '2', '16', '4', '11', '2', '10', '3', '10', '4', '11', '3', '9', '2', '9', '3', '9', '5', '9', '4', '9', '1', '9', '4', '6', '3', '8', '2', '9', '2', '7', '2', '7', '2', '6', '3', '7', '0', '6', '0', '7']
        # ['0', '0', '7', '4', '11', '7', '9', '4', '9', '5', '9', '4', '7', '4', '9', '5', '6', '6', '8', '4', '7', '7', '6', '7', '7', '5', '6', '6', '6', '7', '6', '7', '6', '7', '7', '8', '8', '9', '7', '9', '7', '11', '7', '11', '7', '12', '6', '12', '5', '14', '5', '15', '4', '15', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '15', '14', '15', '13', '16', '13', '15', '12', '15', '13', '15', '12', '14', '12', '15', '11', '15', '11', '14', '10', '14', '10', '14', '8', '14', '8', '14', '8', '13', '7', '13', '6', '13', '5', '13', '5', '12', '4', '13', '4', '11', '3', '12', '4', '11', '4', '10', '3', '11', '1', '11', '6']
        # ['0', '0', '2', '6', '2', '5', '1', '4', '0', '3', '0', '3', '0', '2', '1', '1', '2', '1', '2', '0', '2', '0', '3', '1', '4', '1', '4', '1', '5', '2', '6', '2', '7', '3', '8', '3', '9', '4', '9', '4', '10', '5', '10', '6', '11', '6', '11', '8', '11', '10', '11', '11', '11', '12', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '2', '25', '4', '24', '2', '10', '5', '17', '5', '22', '3', '30', '3', '20', '6', '18', '5', '19', '3', '18', '3', '22', '2', '15', '1', '14', '0', '17', '3', '13', '2', '18', '2', '14', '1', '12', '0', '11', '5', '11', '4', '12', '5', '8', '4', '9', '4', '9', '3', '7', '3', '6']
        # ['0', '0', '3', '9', '1', '7', '0', '7', '0', '5', '0', '5', '0', '4', '1', '4', '1', '3', '1', '2', '1', '2', '1', '1', '3', '1', '3', '1', '4', '1', '3', '0', '5', '0', '5', '0', '5', '1', '6', '2', '6', '3', '7', '3', '8', '4', '9', '5', '8', '6', '8', '7', '8', '8', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '2', '23', '4', '22', '3', '22', '3', '22', '3', '22', '3', '22', '3', '22', '3', '20', '2', '20', '4', '16', '2', '18', '2', '17', '1', '18', '2', '17', '0', '18', '1', '16', '1', '15', '1', '15', '1', '13', '2', '12', '2', '13', '2', '12', '2', '11', '2', '10', '2', '10', '3', '9']
        # ['0', '0', '4', '8', '3', '6', '3', '6', '3', '5', '3', '5', '4', '4', '3', '3', '4', '3', '3', '3', '3', '2', '3', '1', '4', '0', '4', '0', '4', '0', '5', '1', '5', '1', '6', '2', '6', '2', '6', '3', '7', '3', '7', '4', '8', '5', '9', '5', '9', '7', '8', '7', '8', '9', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '13', '16', '16', '8', '22', '14', '19', '13', '19', '11', '20', '15', '10', '2', '6', '11', '25', '6', '2', '19', '20', '5', '8', '17', '15', '17', '5', '8', '18', '15', '5', '9', '5', '12', '5', '14', '5', '12', '6', '11', '5', '11', '5', '11', '4', '11', '4', '11', '4', '10', '3', '10']
        # ['0', '0', '10', '1', '10', '2', '10', '2', '8', '1', '8', '1', '7', '1', '6', '2', '6', '1', '7', '2', '6', '4', '7', '3', '5', '5', '5', '2', '6', '3', '2', '3', '5', '4', '4', '3', '1', '7', '2', '14', '0', '12', '5', '1', '4', '6', '7', '13', '15', '7', '1', '15', '1', '12', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '14', '11', '14', '8', '13', '12', '12', '8', '16', '13', '14', '12', '16', '8', '14', '11', '14', '10', '12', '11', '14', '8', '14', '9', '14', '7', '13', '7', '15', '4', '12', '6', '13', '5', '13', '3', '12', '4', '12', '2', '13', '3', '12', '2', '11', '1', '11', '1', '12', '1', '11', '1']
        # ['0', '0', '6', '0', '7', '0', '7', '1', '7', '3', '7', '3', '7', '3', '7', '3', '8', '4', '7', '4', '9', '4', '9', '5', '10', '5', '10', '5', '11', '5', '11', '5', '12', '4', '13', '5', '13', '5', '14', '5', '15', '5', '15', '6', '17', '6', '16', '7', '17', '8', '17', '9', '17', '10', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '21', '2', '20', '1', '20', '2', '20', '2', '19', '3', '18', '2', '18', '3', '17', '3', '17', '4', '16', '3', '15', '3', '14', '4', '13', '4', '12', '4', '12', '4', '11', '4', '10', '4', '9', '5', '9', '4', '9', '4', '9', '5', '7', '4', '7', '3', '7', '2', '8', '2', '7', '1']
        # ['0', '0', '7', '3', '5', '3', '5', '4', '4', '4', '4', '4', '3', '5', '3', '5', '3', '6', '2', '6', '2', '7', '3', '7', '2', '8', '3', '8', '3', '9', '3', '10', '3', '11', '3', '11', '3', '12', '3', '12', '3', '13', '3', '14', '3', '15', '3', '15', '2', '16', '1', '17', '1', '17', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '19', '13', '19', '13', '18', '12', '18', '12', '18', '12', '17', '11', '17', '11', '17', '10', '16', '9', '16', '8', '16', '7', '15', '7', '14', '6', '14', '6', '14', '4', '13', '4', '12', '4', '12', '3', '12', '3', '11', '2', '10', '2', '9', '2', '9', '2', '9', '2', '8', '2', '7', '2']
        # ['0', '0', '9', '3', '10', '8', '10', '6', '10', '9', '1', '5', '4', '1', '6', '1', '5', '0', '4', '12', '4', '11', '4', '11', '4', '11', '4', '12', '4', '12', '5', '12', '4', '12', '4', '13', '4', '13', '4', '13', '4', '14', '3', '15', '2', '15', '1', '16', '1', '19', '4', '16', '2', '21', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '4', '18', '4', '17', '4', '18', '3', '17', '3', '17', '3', '17', '3', '17', '3', '17', '3', '16', '3', '16', '4', '15', '4', '14', '3', '14', '4', '14', '4', '13', '5', '14', '5', '13', '5', '13', '5', '12', '5', '12', '6', '12', '5', '12', '6', '12', '6', '11', '6', '11', '5', '11']
        # ['0', '0', '9', '8', '1', '7', '3', '7', '4', '7', '3', '7', '4', '8', '3', '8', '4', '7', '4', '8', '5', '8', '5', '8', '5', '8', '6', '9', '6', '9', '7', '9', '8', '9', '8', '9', '9', '10', '9', '10', '10', '11', '10', '11', '10', '12', '10', '13', '10', '13', '10', '14', '9', '15', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '2', '17', '0', '15', '2', '13', '6', '11', '3', '13', '3', '11', '3', '10', '5', '11', '3', '10', '4', '9', '4', '9', '4', '9', '4', '8', '3', '7', '3', '6', '4', '5', '5', '5', '4', '7', '4', '5', '3', '5', '5', '6', '4', '4', '5', '6', '5', '6', '5', '5', '2', '2']
        # ['0', '0', '12', '0', '12', '1', '12', '1', '11', '1', '12', '1', '12', '1', '12', '1', '12', '0', '12', '1', '13', '0', '12', '0', '12', '0', '13', '0', '13', '1', '14', '2', '14', '1', '15', '2', '15', '1', '16', '1', '17', '2', '17', '1', '18', '1', '18', '0', '19', '0', '19', '2', '19', '3', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '14', '5', '14', '5', '14', '5', '14', '5', '14', '5', '14', '5', '13', '5', '13', '4', '13', '4', '12', '4', '12', '4', '12', '3', '12', '3', '12', '2', '11', '2', '11', '2', '11', '1', '11', '2', '11', '1', '11', '1', '11', '0', '10', '0', '11', '1', '11', '0', '11', '0', '11', '0']
        # ['0', '0', '2', '2', '2', '1', '3', '0', '3', '0', '3', '1', '4', '1', '4', '2', '5', '2', '5', '2', '6', '3', '6', '3', '7', '3', '7', '3', '8', '3', '9', '3', '10', '4', '10', '4', '11', '4', '12', '5', '12', '5', '13', '6', '14', '7', '14', '8', '14', '9', '14', '10', '14', '11', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '11', '21', '9', '22', '8', '20', '9', '17', '7', '16', '5', '16', '6', '14', '5', '13', '5', '14', '6', '14', '5', '13', '5', '12', '4', '12', '2', '11', '1', '9', '2', '8', '1', '8', '0', '8', '0', '8', '0', '8', '0', '7', '0', '6', '1', '5', '1', '5', '1', '4', '1', '4']
        # ['0', '0', '9', '1', '8', '2', '7', '2', '5', '2', '5', '1', '5', '2', '4', '1', '4', '2', '2', '2', '3', '2', '3', '3', '1', '4', '1', '3', '0', '3', '0', '4', '1', '4', '1', '5', '1', '5', '1', '6', '2', '6', '2', '7', '4', '7', '4', '7', '5', '8', '6', '7', '8', '6', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '23', '10', '22', '11', '20', '6', '21', '9', '22', '11', '19', '13', '19', '12', '19', '9', '21', '10', '19', '8', '17', '8', '16', '8', '17', '7', '16', '7', '16', '6', '18', '3', '15', '4', '14', '4', '12', '2', '12', '3', '13', '3', '11', '3', '11', '2', '10', '1', '10', '0', '9', '2']
        # ['0', '0', '2', '1', '3', '1', '2', '1', '2', '1', '1', '1', '1', '2', '2', '3', '1', '3', '2', '4', '2', '4', '2', '5', '3', '6', '4', '6', '4', '6', '4', '7', '5', '7', '5', '7', '5', '7', '6', '8', '7', '10', '6', '9', '8', '11', '6', '11', '7', '16', '7', '8', '1', '23', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '21', '3', '18', '4', '17', '8', '20', '2', '21', '5', '13', '4', '18', '8', '17', '6', '12', '3', '16', '5', '15', '5', '14', '6', '14', '6', '12', '5', '10', '6', '10', '5', '9', '5', '7', '5', '7', '4', '7', '4', '6', '5', '4', '5', '5', '5', '4', '4', '5', '3', '3', '2']
        # ['0', '0', '3', '4', '2', '3', '1', '3', '0', '3', '0', '3', '1', '3', '1', '3', '2', '4', '2', '4', '2', '4', '3', '5', '3', '5', '4', '5', '4', '6', '4', '7', '4', '8', '4', '8', '5', '9', '5', '10', '6', '10', '7', '11', '8', '11', '8', '11', '9', '12', '10', '12', '12', '11', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '13', '20', '13', '20', '11', '19', '12', '19', '12', '18', '10', '18', '11', '17', '11', '16', '10', '15', '10', '14', '10', '13', '10', '13', '9', '11', '9', '11', '9', '9', '9', '8', '9', '7', '8', '7', '8', '6', '8', '5', '7', '5', '7', '5', '6', '4', '6', '4', '5', '3', '5', '3']
        # ['0', '0', '8', '8', '8', '9', '8', '8', '7', '8', '7', '8', '7', '7', '6', '6', '7', '6', '6', '6', '6', '5', '6', '5', '6', '5', '6', '5', '6', '4', '6', '4', '6', '3', '7', '3', '7', '2', '7', '2', '8', '1', '8', '0', '8', '0', '9', '1', '9', '2', '8', '4', '8', '5', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '18', '9', '18', '10', '18', '10', '18', '9', '18', '10', '18', '9', '18', '9', '17', '8', '17', '8', '16', '8', '16', '8', '15', '8', '14', '8', '14', '8', '13', '9', '12', '9', '12', '9', '11', '9', '11', '9', '10', '9', '10', '10', '9', '9', '9', '9', '9', '10', '9', '9', '8', '9']
        # ['0', '0', '6', '10', '5', '9', '5', '9', '5', '8', '5', '8', '4', '8', '5', '7', '4', '7', '4', '7', '4', '7', '4', '7', '3', '7', '3', '7', '3', '7', '4', '7', '3', '7', '3', '8', '3', '8', '3', '9', '3', '9', '2', '9', '2', '9', '1', '10', '0', '10', '1', '10', '2', '10', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '15', '4', '18', '5', '20', '2', '16', '2', '14', '2', '18', '3', '19', '1', '13', '4', '15', '3', '14', '0', '16', '0', '18', '0', '15', '4', '14', '3', '12', '3', '16', '2', '13', '3', '13', '3', '11', '5', '11', '4', '12', '5', '11', '6', '11', '6', '11', '5', '10', '6', '10']
        # ['0', '0', '13', '3', '13', '4', '13', '4', '12', '4', '12', '3', '12', '3', '12', '3', '11', '3', '11', '3', '11', '3', '11', '3', '10', '3', '10', '3', '11', '3', '10', '4', '10', '4', '10', '3', '10', '4', '10', '4', '9', '5', '9', '6', '9', '6', '9', '7', '8', '8', '7', '8', '6', '9', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '12', '9', '12', '12', '14', '8', '13', '9', '14', '8', '14', '9', '14', '10', '14', '11', '13', '9', '12', '8', '12', '11', '12', '9', '12', '8', '13', '9', '12', '6', '14', '6', '13', '5', '13', '5', '13', '4', '13', '5', '14', '5', '14', '4', '13', '4', '13', '3', '13', '4', '13', '4']
        # ['0', '0', '13', '4', '12', '4', '12', '4', '11', '4', '11', '4', '11', '3', '10', '3', '10', '4', '10', '3', '9', '3', '9', '3', '8', '3', '8', '3', '8', '3', '8', '4', '8', '4', '7', '4', '7', '5', '7', '5', '6', '6', '6', '6', '5', '7', '4', '7', '4', '7', '2', '8', '1', '8', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '16', '12', '16', '12', '15', '12', '15', '12', '15', '12', '15', '13', '15', '12', '14', '12', '14', '12', '14', '11', '14', '11', '13', '10', '13', '10', '13', '9', '14', '8', '13', '8', '13', '7', '13', '6', '14', '6', '13', '6', '13', '5', '14', '5', '13', '4', '13', '4', '13', '4', '13', '4']
        # ['0', '0', '9', '9', '10', '7', '10', '7', '9', '6', '9', '6', '9', '6', '9', '5', '9', '5', '9', '5', '8', '4', '8', '4', '9', '4', '9', '3', '9', '3', '8', '2', '9', '2', '9', '1', '9', '1', '9', '0', '9', '0', '9', '1', '8', '3', '8', '3', '8', '4', '7', '5', '6', '6', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '15', '14', '8', '10', '6', '15', '9', '4', '19', '18', '5', '13', '6', '22', '8', '6', '12', '6', '4', '12', '12', '12', '12', '9', '12', '10', '11', '9', '9', '12', '11', '9', '9', '8', '11', '9', '9', '10', '10', '10', '9', '9', '9', '9', '9', '9', '9', '10', '9', '10', '8', '9']
        # ['0', '0', '11', '6', '12', '6', '12', '5', '11', '6', '11', '5', '11', '5', '11', '6', '10', '6', '11', '6', '11', '6', '11', '6', '11', '7', '11', '7', '11', '7', '11', '7', '10', '7', '11', '8', '10', '7', '12', '8', '12', '8', '12', '8', '13', '7', '14', '7', '14', '6', '14', '5', '14', '4', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '14', '0', '16', '2', '14', '2', '17', '1', '14', '0', '12', '1', '10', '2', '15', '3', '13', '0', '13', '3', '16', '2', '15', '0', '14', '1', '15', '1', '12', '1', '11', '0', '12', '2', '12', '4', '10', '3', '10', '4', '12', '4', '11', '5', '13', '5', '12', '5', '11', '5', '12', '5']
        if ser.is_open:
            print("serial has opened.")
            # 构造参数数据结构
            anchor_positions = []
            dist = []
            while True:

                data = ser.readline().decode('UTF-8')
                if "predicting" in data:
                    # loop_time += 1
                    # if loop_time >= 100:
                    #     distance = int(input('Enter a number: '))
                    #     # print(distance)
                    #     loop_time = 0
                    data = "".join(filter(lambda s: s in '0123456789,.-', data))
                    # print(data)
                    params = data.split(',')
                    # print(params)
                    # params.append(isLoS)
                    params.append(distance)
                    # writer.writerow(params)

                    apid = params[0]
                    csi = params[5:-1]

                    # print(csi)

                    pred_dist, los_nlos = exec_predict(params[3], params[4], csi)

                    # pred_dist = params[-1]

                    current_ap = APInformation(apid, params[1], params[2], pred_dist, 1, los_nlos)
                    current_ap_ids.append(apid)

                    print("current ap: " + apid)
                    if len(ap_info) == 0:
                        ap_info.append(current_ap)
                    else:
                        exist = 0
                        for i in range(len(ap_info)):
                            if ap_info[i].apid == apid:
                                # ap_info.append(current_ap)
                                ap_info[i].is_valid = 1
                                ap_info[i].is_los = los_nlos
                                ap_info[i].dist = pred_dist
                                exist = 1
                                break
                        if exist == 0:
                            ap_info.append(current_ap)

                    anchor_positions.append(vec3d(float(params[1]), float(params[2]), 0))
                    dist.append(pred_dist)
                    if int(apid) < len(anchor_positions):
                        # 一次循环结束
                        for i in range(len(ap_info)):
                            if not current_ap_ids.__contains__(ap_info[i].apid):
                                ap_info[i].is_valid = 0
                        current_ap_ids.clear()
                        for info in ap_info:
                            print("ap: " + str(info.apid) + "isValid: " + str(info.is_valid))

                        distances = np.array(dist)
                        if len(distances) >= 3:
                            estimated_position = trilateration(anchor_positions, distances)
                            estimated_position = np.round(estimated_position, 3)
                            print("Estimated Position:", estimated_position)
                            localization_res.clear()
                            localization_res.append(estimated_position)
                        anchor_positions.clear()
                        dist.clear()


app = Flask(__name__)
CORS(app)


@app.route("/")
def hello_world():
    return "<p>hello world</p>"


@app.route("/ap")
def get_ap_info():
    return json.dumps(ap_info, cls=MyEncoder)

@app.route("/res")
def get_sta_pos():
    if len(localization_res) != 0:
        return json.dumps(localization_res[0],cls=MyEncoder)

if __name__ == '__main__':
    ap_info = []
    current_ap_ids = []
    localization_res = []
    print("loading model...")
    los_pre_model = load_model("mlp_model_los.h5")
    nlos_pre_model = load_model("mlp_model_nlos.h5")
    classify_model = load_model("mlp_model_los_or_nlos.h5")
    los_MinMaxScaler = joblib.load('mmScaler_los')
    nlos_MinMaxScaler = joblib.load('mmScaler_nlos')
    classify_MinMaxScaler = joblib.load('mmScaler_los_or_nlos')

    info_collector_thread = threading.Thread(target=info_collector)
    info_collector_thread.start()
    app.run()
